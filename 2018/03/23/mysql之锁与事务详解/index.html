<!DOCTYPE html><html lang="zh-CN"><head><meta name="google-site-verification" content="PR6S72-htn-N1oDn9ENMcwi5niLKk0uebDzmRS-oivs"><meta property="wb:webmaster" content="320520520031fedd"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="好好学习，努力搬砖，天天吃草"><title>mysql之锁与事务详解 | 一灰灰Blog</title><link rel="stylesheet" type="text/css" href="//fonts.neworld.org/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/hexblog/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/hexblog/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/hexblog/favicon.ico"><link rel="bookmark" href="/hexblog/favicon.ico"><link rel="apple-touch-icon" href="/hexblog/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/hexblog/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">mysql之锁与事务详解</h1><a id="logo" href="/hexblog/.">一灰灰Blog</a><p style="font-size:18px" class="description">一灰灰的个人博客网站</p></div><div id="nav-menu"><a href="/hexblog/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/hexblog/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/hexblog/about/"><i class="fa fa-user"> 关于</i></a><a href="http://liuyueyi.gitee.io/zweb/#/index"><i class="fa fa-rss"> 网站</i></a><a href="http://liuyueyi.gitee.io/mweb/#/"><i class="fa fa-you"> 古诗选</i></a><hr><br><div id="nav-sub-menu"><a href="/hexblog/categories/技术"><i class="fa fa-right"> 技术</i></a><a href="/hexblog/categories/工作"><i class="fa fa-right"> 工作</i></a><a href="/hexblog/categories/生活"><i class="fa fa-right"> 生活</i></a><a href="/hexblog/categories/杂记"><i class="fa fa-right"> 杂记</i></a></div></div>
<div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="search"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/hexblog/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">mysql之锁与事务详解 <span style="font-size:14px;color:#40759b;font-style:italic;border-bottom: 1px solid #e5e5e5;">&gt;&gt;&gt; by 一灰灰Blog</span></h1><div class="post-meta"><a href="/hexblog/2018/03/23/mysql之锁与事务详解/#saveImg" class="saveImg-icon"></a><a href="/hexblog/2018/03/23/mysql之锁与事务详解/#comments" class="comment-count"></a><p><span class="date">Mar 23, 2018</span><span><a href="/hexblog/categories/技术/" class="category">技术</a><a href="/hexblog/categories/技术/DB/" class="category">DB</a><a href="/hexblog/categories/技术/DB/Mysql/" class="category">Mysql</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><h1 id="Mysql之锁与事务"><a href="#Mysql之锁与事务" class="headerlink" title="Mysql之锁与事务"></a>Mysql之锁与事务</h1><p>平时的业务中，顶多也就是写写简单的sql，连事务都用的少，对锁这一块的了解就更加欠缺了，之前一个大神分享了下mysql的事务隔离级别，感觉挺有意思的，正好发现一个很棒的博文，然后也收集了一些相关知识，正好来学习下，mysql中锁与事务的神秘面纱，主要内容包括</p>
<ol>
<li>共享锁和排它锁的区别以及适合范围</li>
<li>mysql的表锁和行锁的区别</li>
<li>怎么判断一个sql是否执行了锁，执行的是表锁还是行锁</li>
<li>事务是什么，怎么用</li>
<li>事务的特性ACID</li>
<li>事务的隔离级别 (RU, RC, RR, SER)</li>
<li>如何查看mysql使用的隔离级别</li>
</ol>
<a id="more"></a>
<h2 id="I-锁"><a href="#I-锁" class="headerlink" title="I. 锁"></a>I. 锁</h2><p>在学习多线程时，我们也经常会遇到锁这个东西，那个时候谈的比较多的是乐观锁和悲观锁，那这两种锁和DB中常说的共享锁和独占锁有什么区别呢？先给出我们已知的乐观锁和悲观锁定义</p>
<ul>
<li>乐观锁：多线程中的CAS就是一种乐观锁，实际上不加锁，先尝试去执行，如果失败则重试（或者根据失败策略进行处理）</li>
<li>悲观锁：上锁，一次只能有一个线程访问，其他的都只能等待</li>
</ul>
<h3 id="1-共享锁和排它锁"><a href="#1-共享锁和排它锁" class="headerlink" title="1. 共享锁和排它锁"></a>1. 共享锁和排它锁</h3><h4 id="a-共享锁"><a href="#a-共享锁" class="headerlink" title="a. 共享锁"></a>a. 共享锁</h4><p>突出在共享这个关键词上，顾名思义，表示这个锁可以多人共享，一般又可以称为读锁(S锁)</p>
<p>在DB中，读锁表示所有的读取数据的小伙伴都不会被锁阻塞，可以放心大胆的获取数据，专业一点的说法就是同一时刻，允许多个连接并发的读取同一资源</p>
<h4 id="b-排它锁"><a href="#b-排它锁" class="headerlink" title="b. 排它锁"></a>b. 排它锁</h4><p>排它，表示当某个人持有这个锁之后，其他的人再来竞争锁就会失败，只能等待锁释放， 又称为写锁(X锁)</p>
<p>在DB中，写锁表示同一时刻，只能有一个小伙伴操作，其他的不管是读还是写，都得排队，专业说法是写锁会阻塞其他的读锁或写锁请求，确保同一时刻只能有一个连接可以写入资源，并防止其他连接读取或者写资源</p>
<h4 id="c-gapLock-和-next-key-lock"><a href="#c-gapLock-和-next-key-lock" class="headerlink" title="c. gapLock 和 next key lock"></a>c. gapLock 和 next key lock</h4><ul>
<li>next key lock 主要是范围匹配的场景下，会锁某一个范围区间</li>
<li>gapLock 主要用来锁边界</li>
</ul>
<p>如下面的case（说明，columnA是非唯一索引，RR隔离级别）</p>
<ul>
<li><code>where columnA between 10 and 30</code>,  next key lock 确保不会在10, 30 之内插入新的数据行</li>
<li><code>where columnA = 10</code>,  gap lock 确保不会再次插入一个columnA=10的行</li>
</ul>
<h3 id="2-表锁和行锁"><a href="#2-表锁和行锁" class="headerlink" title="2. 表锁和行锁"></a>2. 表锁和行锁</h3><p>对于DB的操作，通常会出现两种情况，一个是锁表，一个锁行</p>
<ul>
<li>表锁：表示整个表被某一个连接占用了写锁，导致其他连接的读锁或者写锁都会阻塞；影响整个表的读写</li>
<li>行锁：表示表中某些行被某个连接占用了写锁，但是其他行，依然可以被其他的连接请求读锁、写锁；仅影响被锁的那些行数据</li>
</ul>
<p>那么一个问题就来了，什么sql会导致行锁，什么会导致写锁？甚至我们如何判断一个sql是否会请求锁，请求的是读锁还是写锁呢？</p>
<h3 id="3-如何使用锁"><a href="#3-如何使用锁" class="headerlink" title="3. 如何使用锁"></a>3. 如何使用锁</h3><p>上面一节抛出了问题，那么现在就是来看下如何使用和分析锁了，首先我们是我们最常见的几个sql</p>
<ul>
<li>select</li>
<li>update</li>
<li>delete</li>
<li>insert</li>
</ul>
<p>其中很容易得出的结论是 <code>update, delete, insert</code> 三个涉及到写锁；而且这种操作绝大部分的场景是操作具体的某些行（想想为什么?），所以更常见的是行锁</p>
<p>select读操作则有点特殊</p>
<h4 id="a-select分析"><a href="#a-select分析" class="headerlink" title="a. select分析"></a>a. select分析</h4><p>MVCC(multiple-version-concurrency-control）是个行级锁的变种，它在普通读情况下避免了加锁操作，因此开销更低。即下面这个没有读锁也没有写锁</p>
<p>快照读，不加锁</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">table</span> ...</span><br></pre></td></tr></table></figure>
<p>当前读，select 语句可以指定读锁和写锁，如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 读锁</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">lock</span> <span class="keyword">in</span> <span class="keyword">share</span> <span class="keyword">mode</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 写锁</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br></pre></td></tr></table></figure>
<p>说明，insert, update, delete 也是当前读，理由如下：</p>
<p>1.update和delete操作流程分解：</p>
<ul>
<li>首先通过where条件查询到第一个满足的记录，并加锁</li>
<li>对这条记录进行更新，再读取下一条记录</li>
<li>对记录更新，继续读下一条直到完毕</li>
</ul>
<p>2.insert操作流程分解：</p>
<ul>
<li>unique key 冲突检测，会有一个当前读</li>
<li>无冲突时，插入</li>
</ul>
<h4 id="b-sql实例分析"><a href="#b-sql实例分析" class="headerlink" title="b. sql实例分析"></a>b. sql实例分析</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--- SQL1：</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t1 <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--- SQL2：</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> t1 <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">10</span>;</span><br></pre></td></tr></table></figure>
<p>在分析上面的sql之前，需要明确几个前提：</p>
<ul>
<li>id是否为主键（id是否有索引）</li>
<li>系统的隔离级别（隔离级别是什么东西可以先看下下文介绍）</li>
</ul>
<p>分别说明:</p>
<p><strong>case1:</strong> 主键+RC级别</p>
<ul>
<li>sql1不加锁，MySQL是使用多版本并发控制的，读不加锁</li>
<li>sql2加写锁（即X锁），只锁 id=10这一行</li>
</ul>
<p><img src="https://raw.githubusercontent.com/liuyueyi/Source/master/img/blog/db/180323_LOCK2.jpg" alt="180323_LOCK2.jpg"></p>
<p><strong>case2:</strong> 唯一索引+rc级别</p>
<ul>
<li>sql2加写锁，如下图的case，就两把锁，一个对应于id unique索引上的id = 10的记录，另一把锁对应于聚簇索引上的[name=’d’,id=10]的记录</li>
</ul>
<p><img src="https://raw.githubusercontent.com/liuyueyi/Source/master/img/blog/db/180323_LOCK3.jpg" alt="180323_LOCK3.jpg"></p>
<p><strong>case3:</strong> id非唯一索引+RC</p>
<ul>
<li>sql2加写锁，如下图的case，会有四个写锁</li>
</ul>
<p><img src="https://raw.githubusercontent.com/liuyueyi/Source/master/img/blog/db/180323_LOCK4.jpg" alt="180323_LOCK4.jpg"></p>
<p><strong>case4:</strong> 无索引+RC</p>
<ul>
<li>sql2分析：若id列上没有索引，SQL会走聚簇索引的全扫描进行过滤，由于过滤是由MySQL Server层面进行的。因此每条记录，无论是否满足条件，都会被加上写锁(X锁)。</li>
<li>但是，为了效率考量，MySQL做了优化，对于不满足条件的记录，会在判断后放锁，最终持有的，是满足条件的记录上的锁，但是不满足条件的记录上的加锁/放锁动作不会省</li>
</ul>
<p><img src="https://raw.githubusercontent.com/liuyueyi/Source/master/img/blog/db/180323_LOCK5.jpg" alt="180323_LOCK5.jpg"></p>
<p><strong>case5:</strong> 主键+RR</p>
<p>加锁同case1</p>
<p><strong>case6:</strong> 唯一索引+RR</p>
<p>加锁同case2</p>
<p><strong>case7:</strong> 非唯一索引+RR</p>
<p>RR级别不允许出现幻读，简单来说，在加锁的过程中，不允许在新增or修改满足条件的记录</p>
<p>即下图中，除了图三中类似的x锁之外，还会新增一个gap锁，这个gap锁主要确保那几个位置上不能插入新的记录</p>
<p><img src="https://raw.githubusercontent.com/liuyueyi/Source/master/img/blog/db/180323_LOCK6.jpg" alt="180323_LOCK6.jpg"></p>
<p><strong>case8:</strong> 无索引+RR</p>
<ul>
<li>在Repeatable Read隔离级别下，如果进行全表扫描的当前读，那么会锁上表中的所有记录，同时会锁上聚簇索引内的所有GAP，杜绝所有的并发 更新/删除/插入 操作</li>
</ul>
<p><img src="https://raw.githubusercontent.com/liuyueyi/Source/master/img/blog/db/180323_LOCK7.jpg" alt="180323_LOCK7.jpg"></p>
<p><strong>case9:</strong> Serializable级别</p>
<ul>
<li>sql2: Serializable隔离级别。对于SQL2：delete from t1 where id = 10; 来说，Serializable隔离级别与Repeatable Read隔离级别完全一致</li>
<li>SQL1: 在RC，RR隔离级别下，都是快照读，不加锁。但是在Serializable隔离级别，SQL1会加读锁，也就是说快照读不复存在，MVCC并发控制降级为Lock-Based CC</li>
</ul>
<hr>
<h2 id="II-事务"><a href="#II-事务" class="headerlink" title="II. 事务"></a>II. 事务</h2><p>事务可谓是db中非常重要的一个知识点了，接下来我们的目标就是弄懂什么是事务，怎么使用事务，以及事务与锁之间的关联是怎样的</p>
<p>说明：本文的分析主要是以mysql的innordb存储引擎为标准</p>
<h3 id="1-定义"><a href="#1-定义" class="headerlink" title="1. 定义"></a>1. 定义</h3><p>事务就是一组原子性的sql，或者说一个独立的工作单元。 </p>
<p>事务就是说，要么mysql引擎会全部执行这一组sql语句，要么全部都不执行（比如其中一条语句失败的话）。</p>
<h3 id="2-ACID特性"><a href="#2-ACID特性" class="headerlink" title="2. ACID特性"></a>2. ACID特性</h3><h4 id="a-A-atomiciy-原子性"><a href="#a-A-atomiciy-原子性" class="headerlink" title="a. A:atomiciy 原子性"></a>a. A:atomiciy 原子性</h4><p>一个事务必须保证其中的操作要么全部执行，要么全部回滚，不可能存在只执行了一部分这种情况出现。</p>
<h4 id="b-C-consistency一致性"><a href="#b-C-consistency一致性" class="headerlink" title="b. C:consistency一致性"></a>b. C:consistency一致性</h4><p>数据必须保证从一种一致性的状态转换为另一种一致性状态。</p>
<h4 id="c-I-isolation-隔离性"><a href="#c-I-isolation-隔离性" class="headerlink" title="c. I:isolation 隔离性"></a>c. I:isolation 隔离性</h4><p>在一个事务未执行完毕时，通常会保证其他Session 无法看到这个事务的执行结果</p>
<h4 id="d-D-durability-持久性"><a href="#d-D-durability-持久性" class="headerlink" title="d. D:durability 持久性"></a>d. D:durability 持久性</h4><p>事务一旦commit，则数据就会保存下来，即使提交完之后系统崩溃，数据也不会丢失</p>
<h3 id="3-隔离级别"><a href="#3-隔离级别" class="headerlink" title="3. 隔离级别"></a>3. 隔离级别</h3><p>前面在分析锁的sql时，就提到了隔离级别，通常有四种： RU, RC, RR, Serializable</p>
<p>在说明这个之前，先了解几个概念</p>
<h4 id="a-基本概念"><a href="#a-基本概念" class="headerlink" title="a. 基本概念"></a>a. 基本概念</h4><ul>
<li>脏读：读取到一个事务未提交的数据，因为这个事务最终无法保证一定执行成功，那么读取到的数据就无法保证一定准确</li>
<li>不可重复读：简单来说就是在一个事务中读取的数据可能产生变化，同样的sql，在一个事务中执行多次，可能得到不同的结果</li>
<li>幻读：会话T1事务中执行一次查询，然后会话T2新插入一行记录，这行记录恰好可以满足T1所使用的查询的条件。然后T1又使用相同 的查询再次对表进行检索，但是此时却看到了事务T2刚才插入的新行</li>
<li>加锁读：<code>select * from table ...</code> 的执行是否加了读锁 (这个可以参考上面的sql加锁分析）</li>
</ul>
<h4 id="b-RU-Read-Uncommited-未提交读"><a href="#b-RU-Read-Uncommited-未提交读" class="headerlink" title="b. RU: Read Uncommited 未提交读"></a>b. RU: Read Uncommited 未提交读</h4><p>事务中的修改，即使没有提交，对其他会话也是可见的，即表示可能出现脏读，一般数据库都不采用这种方案</p>
<h4 id="c-RC-Read-Commited-提交读"><a href="#c-RC-Read-Commited-提交读" class="headerlink" title="c. RC: Read Commited 提交读"></a>c. RC: Read Commited 提交读</h4><p>这个隔离级别保证了一个事务如果没有完全成功（commit执行完），事务中的操作对其他会话是不可见的，避免了脏读的可能</p>
<p>但是可能出现不可重复度的情况，举例说明：</p>
<ul>
<li>会话T1, 执行查询 <code>select * from where id=1</code>，第一次返回一个结果</li>
<li>会话T2, 执行修改 <code>update table set updated=xxx where id=1</code> 并提交</li>
<li>会话T1，再次执行查询 <code>select * from where id=1</code>，这次返回的结果中update字段就和前面的不一样了</li>
</ul>
<p>实际的生产环境中，这个级别用的比较多，特意查了下公司的db隔离级别就是这个</p>
<p>一个RC级别的演示过程：</p>
<ul>
<li>会话1，开启事务，查询</li>
<li>会话2，开启事务，更新DB，提交事务</li>
<li>会话1，再次查询，提交事务</li>
<li>从下面的实际演示结果可以知道，会话1，同一个sql，两次执行的结果不同</li>
</ul>
<p><img src="https://raw.githubusercontent.com/liuyueyi/Source/master/img/blog/db/180323_LOCK8.gif" alt="180323_LOCK8.gif"></p>
<p>相关的sql代码如下:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 设置会话隔离级别</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">session</span> <span class="keyword">transaction</span> ioslation <span class="keyword">read</span> commited;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看当前会话隔离级别</span></span><br><span class="line"><span class="keyword">select</span> @@tx_isolation;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话1的操作</span></span><br><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> newuser <span class="keyword">where</span> userId=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话2开始操作</span></span><br><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> newuser <span class="keyword">where</span> userId=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">update</span> newuser <span class="keyword">set</span> <span class="keyword">updated</span>=<span class="number">1521786092</span> <span class="keyword">where</span> userId=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> newuser <span class="keyword">where</span> userId=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 再次进入会话1，同样执行上次的sql，对比两次输出结果</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> newuser <span class="keyword">where</span> userId=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 注意观察，会话1，前后两次这个sql的输出结果，特别是updated字段</span></span><br><span class="line"><span class="comment">-- 正常情况会如上面的demo图，会发生改变</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关闭会话</span></span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 再次查询</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> newuser <span class="keyword">where</span> userId=<span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<h4 id="d-RR-Repeatable-Read-可重复度"><a href="#d-RR-Repeatable-Read-可重复度" class="headerlink" title="d. RR: Repeatable Read 可重复度"></a>d. RR: Repeatable Read 可重复度</h4><p>一个事务中多次执行统一读SQL,返回结果一样。 这个隔离级别解决了脏读的问题，幻读问题</p>
<p>实例演示解决脏读的过程(将上面的过程同样来一次）</p>
<ul>
<li>发现不管会话1同一个sql，返回的结果都是相同的</li>
</ul>
<p><img src="https://raw.githubusercontent.com/liuyueyi/Source/master/img/blog/db/180323_LOCK9.gif" alt="180323_LOCK9.gif"></p>
<h4 id="e-Serializable-可串行化"><a href="#e-Serializable-可串行化" class="headerlink" title="e. Serializable 可串行化"></a>e. Serializable 可串行化</h4><p>最强的隔离级别，通过给事务中每次读取的行加锁，写加写锁，保证不产生幻读问题，但是会导致大量超时以及锁争用问题。</p>
<h4 id="f-常用命令"><a href="#f-常用命令" class="headerlink" title="f. 常用命令"></a>f. 常用命令</h4><ul>
<li>查看当前会话隔离级别: <code>select @@tx_isolation</code></li>
<li>查看系统当前隔离级别: <code>select @@global.tx_isolation</code></li>
<li>设置当前会话隔离级别: <code>set session transaction isolation level read committed;</code></li>
<li>设置系统当前隔离级别: <code>set global transaction isolation level read committed;</code></li>
<li>命令行，<ul>
<li>开始事务: <code>start transactioin;</code></li>
<li>提交: <code>commit;</code></li>
</ul>
</li>
</ul>
<h3 id="4-使用姿势"><a href="#4-使用姿势" class="headerlink" title="4. 使用姿势"></a>4. 使用姿势</h3><p>前面演示事务隔离级别的时候，给出的实例就演示了事务的使用姿势，一般作为三步骤：</p>
<ul>
<li>开始事务 <code>start transaction;</code></li>
<li>执行你的业务sql</li>
<li>提交事务 <code>commit;</code></li>
</ul>
<p>我们现在演示以下一个事务中，读锁、写锁对另一个事务的影响</p>
<h4 id="a-读锁的影响"><a href="#a-读锁的影响" class="headerlink" title="a. 读锁的影响"></a>a. 读锁的影响</h4><p>我们采用mysql默认的RR级别进行测试，userId为主键</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 会话1</span></span><br><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> newuser <span class="keyword">where</span> userId=<span class="number">1</span> <span class="keyword">lock</span> <span class="keyword">in</span> <span class="keyword">share</span> <span class="keyword">mode</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 转入会话2</span></span><br><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> newuser <span class="keyword">where</span> userId=<span class="number">1</span>; <span class="comment">-- 会输出</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> newuser <span class="keyword">where</span> userId=<span class="number">1</span> <span class="keyword">lock</span> <span class="keyword">in</span> <span class="keyword">share</span> <span class="keyword">mode</span>; <span class="comment">-- 会输出</span></span><br><span class="line"><span class="keyword">update</span> newuser <span class="keyword">set</span> <span class="keyword">updated</span>=<span class="number">1521787137</span> <span class="keyword">where</span> userId=<span class="number">1</span>; <span class="comment">-- 会挂起</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 转入会话1</span></span><br><span class="line"><span class="comment">-- 提交, 此时观察会话2的写是否完成</span></span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 转入会话2</span></span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>
<p>实际执行演示:</p>
<p><img src="https://raw.githubusercontent.com/liuyueyi/Source/master/img/blog/db/180323_LOCK10.gif" alt="180323_LOCK10.gif"></p>
<h4 id="b-写锁的影响"><a href="#b-写锁的影响" class="headerlink" title="b. 写锁的影响"></a>b. 写锁的影响</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 会话1</span></span><br><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> newuser <span class="keyword">where</span> userId=<span class="number">1</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 转入会话2</span></span><br><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> newuser <span class="keyword">where</span> userId=<span class="number">1</span>; <span class="comment">-- 会输出</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> newuser <span class="keyword">where</span> userId=<span class="number">1</span> <span class="keyword">lock</span> <span class="keyword">in</span> <span class="keyword">share</span> <span class="keyword">mode</span>; <span class="comment">-- 会挂住</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- update newuser set updated=1521787137 where userId=1; -- 会挂住</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 转入会话1</span></span><br><span class="line"><span class="comment">-- 提交, 此时观察会话2的写是否完成</span></span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 转入会话2</span></span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>
<p>实际执行演示:</p>
<p><img src="https://raw.githubusercontent.com/liuyueyi/Source/master/img/blog/db/180323_LOCK11.gif" alt="180323_LOCK11.gif"></p>
<h4 id="c-小结"><a href="#c-小结" class="headerlink" title="c. 小结"></a>c. 小结</h4><ul>
<li>读锁，会阻塞其他请求写锁的sql执行</li>
<li>写锁，会阻塞其他读锁和写锁的sql执行</li>
<li>事务只有在提交之后，才会释放锁</li>
<li>额外注意，上面事务在提交之后才会释放锁，因此如果两个事务循环依赖锁时，可能发生死锁</li>
</ul>
<hr>
<h2 id="III-小结"><a href="#III-小结" class="headerlink" title="III. 小结"></a>III. 小结</h2><p>锁和事务可谓是db中非常重要的知识点了，在我们实际的编码过程中（一般针对mysql, innordb存储引擎，rr隔离级别），做出下面的一些总结</p>
<h3 id="1-sql分析"><a href="#1-sql分析" class="headerlink" title="1. sql分析"></a>1. sql分析</h3><ul>
<li><code>select * from table where xxx;</code>   （读快照，一般不加锁）</li>
<li><code>select * from table where xxx lock in share mode;</code>  (读锁，会阻塞其他的写锁请求，但其他的读锁请求没有影响）</li>
<li><code>select * from table where xxx for update;</code>  (写锁，会阻塞其他的读写请求）</li>
<li><code>update tableName set xxx</code> (写锁）</li>
<li><code>insert</code> （写锁）</li>
<li><code>delete</code> （写锁）</li>
</ul>
<h3 id="2-事务"><a href="#2-事务" class="headerlink" title="2. 事务"></a>2. 事务</h3><p>简单来讲，事务就是一组sql，要么全部执行成功，要么全部失败</p>
<p><strong>四个特性：</strong> A(原子性)C(一致性)I(隔离性)D (持久性)</p>
<p><strong>四种隔离级别：</strong>(mysql 默认采用的是RR级别)</p>
<table>
<thead>
<tr>
<th>隔离级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
<th>加锁读</th>
</tr>
</thead>
<tbody>
<tr>
<td>read uncommited</td>
<td>可能</td>
<td>可能</td>
<td>可能</td>
<td>无</td>
</tr>
<tr>
<td>read commited</td>
<td>不可能</td>
<td>可能</td>
<td>可能</td>
<td>无</td>
</tr>
<tr>
<td>repeatable read</td>
<td>不可能</td>
<td>不可能</td>
<td>不可能</td>
<td>无</td>
</tr>
<tr>
<td>serializable</td>
<td>不可能</td>
<td>不可能</td>
<td>不可能</td>
<td>有</td>
</tr>
</tbody>
</table>
<p><strong>使用姿势：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- xxx 具体的sql</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>
<h2 id="IV-其他"><a href="#IV-其他" class="headerlink" title="IV. 其他"></a>IV. 其他</h2><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://blog.csdn.net/lemon89/article/details/51477497" target="_blank" rel="noopener">深入理解Mysql——锁、事务与并发控制</a></li>
<li><a href="http://hedengcheng.com/?p=771#_Toc374698322" target="_blank" rel="noopener">MySQL 加锁处理分析</a></li>
</ul>
<h3 id="个人博客：-一灰灰Blog"><a href="#个人博客：-一灰灰Blog" class="headerlink" title="个人博客： 一灰灰Blog"></a>个人博客： <a href="https://liuyueyi.github.io/hexblog" target="_blank" rel="noopener">一灰灰Blog</a></h3><p>基于hexo + github pages搭建的个人博客，记录所有学习和工作中的博文，欢迎大家前去逛逛</p>
<h3 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h3><p>尽信书则不如，已上内容，纯属一家之言，因本人能力一般，见识有限，如发现bug或者有更好的建议，随时欢迎批评指正</p>
<ul>
<li>微博地址: <a href="https://weibo.com/p/1005052169825577/home" target="_blank" rel="noopener">小灰灰Blog</a></li>
<li>QQ： 一灰灰/3302797840</li>
</ul>
<h3 id="扫描关注"><a href="#扫描关注" class="headerlink" title="扫描关注"></a>扫描关注</h3><p><img src="https://raw.githubusercontent.com/liuyueyi/Source/master/img/info/blogInfoV2.png" alt="QrCode"></p>
</div><div class="tags"><a href="/hexblog/tags/mysql/">mysql</a><a href="/hexblog/tags/锁/">锁</a><a href="/hexblog/tags/事务/">事务</a></div><div style="text-align:center"><br><button style="color:red;background-color: #f44336;border: none;border-radius: 8px;color: white;padding: 10px 30px;text-align: center;text-decoration: none;font-size: 16px;" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">打赏</button><br><span style="display: block;color: #9d9d9d;font: 14px/2 &amp;quot;Microsoft Yahei&amp;quot;">如果觉得我的文章对您有帮助，请随意打赏。</span><br><div id="QR" style="display: none; margin-top: 20px;" class="row"><div id="wechat" style="display: inline-block;width:44%;margin-left:6%;text-align:center;"><a href="javascript:void(0)"><img src="https://s3.mogucdn.com/mlcdn/c45406/180104_50136i33id9e49j1f7k2e219e3ldf_800x798.png" alt="WeChat Pay" style="width:80%;height:80%;max-height:200px;max-width:200px"></a><p style="text-align:center">微信打赏</p></div><div id="alipay" style="display: inline-block;width:44%;text-align:center"><a href="javascript:void(0)"><img src="https://s3.mogucdn.com/mlcdn/c45406/180104_0e6afl33b23lacj6ji2d7d060aiak_798x800.png" alt="Alipay" style="width:80%;height:80%;max-height:200px;max-width:200px"></a><p style="text-align:center">支付宝打赏</p></div></div></div><div class="article-footer-copyright"><url><li>版权声明：本文由<b> 一灰灰 </b><span>发表于</span><a href="/hexblog/"> 一灰灰Blog </a></li><li>转载声明：自由转载-非商用-非衍生-保持署名，非商业转载请注明作者及出处，商业转载请联系作者本人。</li><li id="blogTitleCp">文章标题：<a style="word-wrap:break-word">mysql之锁与事务详解</a></li><li>文章链接：<a id="blogLink" style="word-wrap:break-word"></a><script>var blogLink = decodeURI(window.location.href);
var doc = document.getElementById('blogLink');
doc.setAttribute("href", blogLink);
doc.innerHTML=blogLink;</script></li></url></div><div class="post-share"><div><script src="https://s3.mogucdn.com/mlcdn/c45406/1520387600580_dom-to-image.min.js" charset="utf-8"></script><script>var url;
console.log('start--->',(new Date()).valueOf());
domtoimage.toPng(document.getElementsByClassName('layout-l')[0])
    .then(function (dataUrl) {
        url = dataUrl;
        console.log('end--->',(new Date()).valueOf());
     })
    .catch(function (error) {});
function link() {
    var title = document.getElementById('blogTitleCp').children[0].innerText;
    console.log("blog title: ", title);
    window.open().document.write('<html><head><title>'+ title + '</title></head><body><div style=\'text-align:center\' ><a download="一灰灰Blog博文_' + title + '.png" href="'+url+'"><img title="点击下载博文图：' + title + '" src="' + url + '" /></a></div></body></html>');
}</script><span style="float:center;font-size:20px;font-weight:solid;color:gray">渲染：</span><a id="saveImg" href="javascript:void(0)" onclick="link()" class="save_img">保存图片</a></div><div id="share" class="soshm social-share"><span style="float:center;font-size:20px;font-weight:solid;color:gray">分享：</span></div></div><div class="post-nav"><a href="/hexblog/2018/04/01/Css学习手册之基本篇/" class="pre">Css学习手册之基本篇</a><a href="/hexblog/2018/03/22/mysql之索引的工作机制/" class="next">mysql之索引的工作机制</a></div><div id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zNDY0OC8xMTE4NQ=="></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei"> 文章目录</i><a title="点击展开或隐藏分类" href="javascript:void(0)" onclick="showOrHide('toc', 'toc-expand', 'none')"><span id="toc-expand" style="font-size:12px;color:red"> 点击收起 </span></a></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Mysql之锁与事务"><span class="toc-text">Mysql之锁与事务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#I-锁"><span class="toc-text">I. 锁</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-共享锁和排它锁"><span class="toc-text">1. 共享锁和排它锁</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-共享锁"><span class="toc-text">a. 共享锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-排它锁"><span class="toc-text">b. 排它锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-gapLock-和-next-key-lock"><span class="toc-text">c. gapLock 和 next key lock</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-表锁和行锁"><span class="toc-text">2. 表锁和行锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-如何使用锁"><span class="toc-text">3. 如何使用锁</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-select分析"><span class="toc-text">a. select分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-sql实例分析"><span class="toc-text">b. sql实例分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#II-事务"><span class="toc-text">II. 事务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-定义"><span class="toc-text">1. 定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-ACID特性"><span class="toc-text">2. ACID特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-A-atomiciy-原子性"><span class="toc-text">a. A:atomiciy 原子性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-C-consistency一致性"><span class="toc-text">b. C:consistency一致性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-I-isolation-隔离性"><span class="toc-text">c. I:isolation 隔离性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#d-D-durability-持久性"><span class="toc-text">d. D:durability 持久性</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-隔离级别"><span class="toc-text">3. 隔离级别</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-基本概念"><span class="toc-text">a. 基本概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-RU-Read-Uncommited-未提交读"><span class="toc-text">b. RU: Read Uncommited 未提交读</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-RC-Read-Commited-提交读"><span class="toc-text">c. RC: Read Commited 提交读</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#d-RR-Repeatable-Read-可重复度"><span class="toc-text">d. RR: Repeatable Read 可重复度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#e-Serializable-可串行化"><span class="toc-text">e. Serializable 可串行化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#f-常用命令"><span class="toc-text">f. 常用命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-使用姿势"><span class="toc-text">4. 使用姿势</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-读锁的影响"><span class="toc-text">a. 读锁的影响</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-写锁的影响"><span class="toc-text">b. 写锁的影响</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-小结"><span class="toc-text">c. 小结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#III-小结"><span class="toc-text">III. 小结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-sql分析"><span class="toc-text">1. sql分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-事务"><span class="toc-text">2. 事务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IV-其他"><span class="toc-text">IV. 其他</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#参考"><span class="toc-text">参考</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#个人博客：-一灰灰Blog"><span class="toc-text">个人博客： 一灰灰Blog</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#声明"><span class="toc-text">声明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#扫描关注"><span class="toc-text">扫描关注</span></a></li></ol></li></ol></li></ol></div><div class="widget"><div class="widget-title"><a href="/hexblog/about/"><i class="fa fa-user"> 一灰灰Blog</i></a><a title="点击展开或收起条目" href="javascript:void(0)" onclick="showOrHide('info-list', 'info-list-expand', 'none')"><span id="info-list-expand" style="font-size:12px;color:red"> 点击收起 </span></a></div><ul class="post-list info-list"><li style="text-align:center"><img src="//s3.mogucdn.com/mlcdn/c45406/170419_637cgff527i8k9k8h512iaf36cdia_600x600.jpg" style="max-width:80px;radius:80px"/><p style="text-align:center">好好学习，天天搬砖</p><hr style="height:0.1px;border:none;border-top:1px dashed #0066CC;"/></li><li class="post-list-item"><a href="mailto:bangzewu@126.com" title="126邮箱" class="post-list-link"><i class="fa fa-email">  bangzewu@126.com</i></a></li><li class="post-list-item"><a href="//github.com/liuyueyi" title="Git主页" target="_blank" class="post-list-link"><i class="fa fa-github">  github.com/liuyueyi</i></a></li><li class="post-list-item"><a href="" title="QQ" class="post-list-link"><i class="fa fa-you">  QQ:3302797840</i></a></li><li class="post-list-item"><a href="//weibo.com/p/1005052169825577/home" title="微博主页" target="_blank" class="post-list-link"><i class="fa fa-weibo">  微博:小灰灰Blog</i></a></li><li class="post-list-item"><i class="fa fa-weixin">  微信公众号</i></li><li style="text-align:center" class="post-list-item"><img src="https://s10.mogucdn.com/mlcdn/c45406/171229_1cgld3igbelkbc70cd8af1j3809kb_150x150.jpg"/></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章(10)</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/hexblog/2018/04/11/Mybatis框架学习之使用篇二：标签语法/">Mybatis框架学习之使用篇二：标签语法</a></li><li class="post-list-item"><a class="post-list-link" href="/hexblog/2018/04/11/Mybatis框架学习之使用篇一：基本环境/">Mybatis框架学习之使用篇一：基本环境</a></li><li class="post-list-item"><a class="post-list-link" href="/hexblog/2018/04/10/Java实现邮件发送/">Java实现邮件发送</a></li><li class="post-list-item"><a class="post-list-link" href="/hexblog/2018/04/09/基于ForkJoin构建一个简单易用的并发组件/">基于ForkJoin构建一个简单易用的并发组件</a></li><li class="post-list-item"><a class="post-list-link" href="/hexblog/2018/04/01/Css实战训练之图片点击放大/">Css实战训练之图片点击放大</a></li><li class="post-list-item"><a class="post-list-link" href="/hexblog/2018/04/01/Css学习手册之基本篇/">Css学习手册之基本篇</a></li><li class="post-list-item"><a class="post-list-link" href="/hexblog/2018/03/23/mysql之锁与事务详解/">mysql之锁与事务详解</a></li><li class="post-list-item"><a class="post-list-link" href="/hexblog/2018/03/22/mysql之索引的工作机制/">mysql之索引的工作机制</a></li><li class="post-list-item"><a class="post-list-link" href="/hexblog/2018/03/22/mysql基本语法学习小结/">mysql基本语法学习小结</a></li><li class="post-list-item"><a class="post-list-link" href="/hexblog/2018/03/19/常用Alfred插件/">常用Alfred工具</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类(55)</i><a title="点击展开或隐藏分类" href="javascript:void(0)" onclick="showOrHide('category-list-child', 'category-expand', 'block')"><span id="category-expand" style="font-size:12px;color:red"> 点击展开 </span></a></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/工作/">工作</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/工作/技术尝鲜/">技术尝鲜</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/">技术</a><span class="category-list-count">47</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Android/">Android</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Android/一封/">一封</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/BugFix/">BugFix</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/BugFix/Java/">Java</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/BugFix/Java/Image/">Image</a><span class="category-list-count">2</span></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/DB/">DB</a><span class="category-list-count">5</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/DB/Mybatis/">Mybatis</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/DB/Mysql/">Mysql</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Java/">Java</a><span class="category-list-count">19</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Java/IO/">IO</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Java/JDK/">JDK</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Java/JVM/">JVM</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Java/JavaWeb/">JavaWeb</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Java/Spring/">Spring</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Java/并发/">并发</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Quick系列项目/">Quick系列项目</a><span class="category-list-count">11</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Quick系列项目/QuickAlarm/">QuickAlarm</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Quick系列项目/QuickSpi/">QuickSpi</a><span class="category-list-count">4</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Redis/">Redis</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Shell/">Shell</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Shell/Git/">Git</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Shell/Git/Maven/">Maven</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Shell/Nginx/">Nginx</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Shell/环境搭建/">环境搭建</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/前端/">前端</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/前端/Chrome/">Chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/前端/Css/">Css</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/前端/Jquery/">Jquery</a><span class="category-list-count">1</span></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/杂记/">杂记</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/杂记/idea/">idea</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/杂记/小工具/">小工具</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/生活/">生活</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/生活/随笔/">随笔</a><span class="category-list-count">1</span></li></ul></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签墙(55)</i><a title="点击展开或隐藏分类" href="javascript:void(0)" onclick="showOrHide('tagcloud', 'tag-expand', 'none')"><span id="tag-expand" style="font-size:12px;color:red"> 点击收起 </span></a></div><div class="tagcloud"><!--!= tagcloud({min_font: 15, max_font: 15, amount: 100, orderby: 'count'})--><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/JDK/">JDK</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/JVM/">JVM</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/日记/">日记</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Android/">Android</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/一封/">一封</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/RelativeLayout/">RelativeLayout</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/CountDownTimer/">CountDownTimer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Bugfix/">Bugfix</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Java/">Java</a><span class="tag-list-count">34</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/batik/">batik</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Png/">Png</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Gitbook/">Gitbook</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Centos/">Centos</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/教程/">教程</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Hexo/">Hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Chrome/">Chrome</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/工具/">工具</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/css/">css</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/笔记/">笔记</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/并发/">并发</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/ForkJoin/">ForkJoin</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Reflect/">Reflect</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Jquery/">Jquery</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/ClassLoader/">ClassLoader</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/双亲委托/">双亲委托</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/内存结构/">内存结构</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/垃圾回收/">垃圾回收</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/JavaWeb/">JavaWeb</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Filter/">Filter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Servlet/">Servlet</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Initialize/">Initialize</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/File/">File</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/ScheduledExecutorService/">ScheduledExecutorService</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/IO/">IO</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/clone/">clone</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/beancopy/">beancopy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/ThreadPoolExecutor/">ThreadPoolExecutor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Nginx/">Nginx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/配置/">配置</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Redis/">Redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/distributeLock/">distributeLock</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/SPI/">SPI</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/整体设计/">整体设计</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/使用手册/">使用手册</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Spring/">Spring</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/RequestParam/">RequestParam</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Jsonp/">Jsonp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/CORS/">CORS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Exception/">Exception</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Response/">Response</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/mysql/">mysql</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/索引/">索引</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/锁/">锁</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/事务/">事务</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Github/">Github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Maven/">Maven</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/BugFix/">BugFix</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/BufferedImage/">BufferedImage</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Jpeg/">Jpeg</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Okhttp/">Okhttp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/QuickAlarm/">QuickAlarm</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/hystrix/">hystrix</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/随笔/">随笔</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Email/">Email</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/mybatis/">mybatis</a><span class="tag-list-count">2</span></li></ul></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档(55)</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/hexblog/archives/2018/04/">四月 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexblog/archives/2018/03/">三月 2018</a><span class="archive-list-count">16</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexblog/archives/2018/02/">二月 2018</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexblog/archives/2018/01/">一月 2018</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexblog/archives/2017/12/">十二月 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexblog/archives/2017/09/">九月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexblog/archives/2017/05/">五月 2017</a><span class="archive-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 更多链接</i></div><ul style="padding-top:10px"></ul><li style="padding-top:2px"><a href="//my.oschina.net/u/566591" title="开源中国" target="_blank">开源中国</a></li><li style="padding-top:2px"><a href="//blog.csdn.net/liuyueyi25" title="CSDN" target="_blank">CSDN</a></li><li style="padding-top:2px"><a href="//www.jianshu.com/u/5902ab08e670" title="简书" target="_blank">简书</a></li><li style="padding-top:2px"><a href="//juejin.im/user/5a2a4b095188252ae93adbbf/posts" title="掘金" target="_blank">掘金</a></li><li style="padding-top:2px"><a href="//www.toutiao.com/c/user/69862071663/#mid=1579653107239950" title="头条" target="_blank">头条</a></li><li style="padding-top:2px"><a href="//cloud.tencent.com/developer/column/1847" title="云+" target="_blank">云+</a></li><li style="padding-top:2px"><a href="//github.com/liuyueyi" title="Github" target="_blank">Github</a></li><li style="padding-top:2px"><a href="//gitee.com/liuyueyi" title="Gitee" target="_blank">Gitee</a></li></div><div class="widget"><div class="widget-title"><i onclick="var qr = document.getElementById('qrcode'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}" style="cursor:pointer" class="fa fa-hit"> 点赞(点击展开)</i></div><ul id="qrcode" style="display:none;" class="post-list"><br/><li style="text-align:center" class="post-list-item"><a href="javascript:void(0)" target="_blank"><img src="https://s3.mogucdn.com/mlcdn/c45406/180104_50136i33id9e49j1f7k2e219e3ldf_800x798.png" alt="WeChat Pay" style="width:75%"/><br/><p style="text-align:center">微信打赏</p></a></li><li style="text-align:center" class="post-list-item"><a href="javascript:void(0)" target="_blank"><img src="https://s3.mogucdn.com/mlcdn/c45406/180104_0e6afl33b23lacj6ji2d7d060aiak_798x800.png" alt="Alipay" style="width:75%"/><br/><p style="text-align:center">支付宝打赏</p></a></li></ul></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="https://zbang.online/webs"><img src="//s3.mogucdn.com/mlcdn/c45406/170419_637cgff527i8k9k8h512iaf36cdia_600x600.jpg" style="max-width: 44px;border-radius:44px"></a></p><p><a href="https://github.com/liuyueyi" target="_blank">GitHub</a> |  <a href="mailto:bangzewu@126.com">email</a> |  <a href="/hexblog/about/">关于 |</a><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p></p><p><span> Copyright &copy;<a href="/hexblog/." rel="nofollow">YiHui.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?028d9e53f991d9739ecc7cc42e13c500";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/hexblog/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/hexblog/js/toctotop.js?v=2.0.1" async></script><script src="https://s3.mogucdn.com/mlcdn/c45406/1520407228303_social-share.min.js" charset="utf-8"></script><link rel="stylesheet" href="https://s3.mogucdn.com/mlcdn/c45406/1518422561591_share.min.css"><script>(function(d, s) {
  var j, e = d.getElementsByTagName('body')[0];
  if (typeof LivereTower === 'function') { return; }
  j = d.createElement(s);
  j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
  j.async = true;
  e.appendChild(j);
})(document, 'script');
</script></body><script type="text/javascript" src="/hexblog/js/common.js?v=2.0.1" async></script></html>