<!DOCTYPE html><html lang="zh-CN"><head><meta name="google-site-verification" content="PR6S72-htn-N1oDn9ENMcwi5niLKk0uebDzmRS-oivs"><meta property="wb:webmaster" content="320520520031fedd"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="好好学习，努力搬砖，天天吃草"><title>Java 借助ImageMagic实现图片编辑服务 | 一灰灰Blog</title><link rel="stylesheet" type="text/css" href="//fonts.neworld.org/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/hexblog/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/hexblog/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/hexblog/favicon.ico"><link rel="bookmark" href="/hexblog/favicon.ico"><link rel="apple-touch-icon" href="/hexblog/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/hexblog/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Java 借助ImageMagic实现图片编辑服务</h1><a id="logo" href="/hexblog/.">一灰灰Blog</a><p style="font-size:18px" class="description">一灰灰的个人博客网站</p></div><div id="nav-menu"><a href="/hexblog/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/hexblog/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/hexblog/about/"><i class="fa fa-user"> 关于</i></a><a href="http://liuyueyi.gitee.io/zweb/#/index"><i class="fa fa-rss"> 网站</i></a><a href="http://liuyueyi.gitee.io/mweb/#/"><i class="fa fa-you"> 古诗选</i></a><hr><br><div id="nav-sub-menu"><a href="/hexblog/categories/技术"><i class="fa fa-right"> 技术</i></a><a href="/hexblog/categories/工作"><i class="fa fa-right"> 工作</i></a><a href="/hexblog/categories/生活"><i class="fa fa-right"> 生活</i></a><a href="/hexblog/categories/杂记"><i class="fa fa-right"> 杂记</i></a></div></div>
<div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="search"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/hexblog/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Java 借助ImageMagic实现图片编辑服务 <span style="font-size:14px;color:#40759b;font-style:italic;border-bottom: 1px solid #e5e5e5;">&gt;&gt;&gt; by 一灰灰Blog</span></h1><div class="post-meta"><a href="/hexblog/2018/04/17/Java-借助ImageMagic实现图片编辑服务/#saveImg" class="saveImg-icon"></a><a href="/hexblog/2018/04/17/Java-借助ImageMagic实现图片编辑服务/#comments" class="comment-count"></a><p><span class="date">Apr 17, 2018</span><span><a href="/hexblog/categories/技术/" class="category">技术</a><a href="/hexblog/categories/技术/Quick系列项目/" class="category">Quick系列项目</a><a href="/hexblog/categories/技术/Quick系列项目/QuickMedia/" class="category">QuickMedia</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><h1 id="Java-借助ImageMagic实现图片编辑服务"><a href="#Java-借助ImageMagic实现图片编辑服务" class="headerlink" title="Java 借助ImageMagic实现图片编辑服务"></a>Java 借助ImageMagic实现图片编辑服务</h1><p>java原生对于图片的编辑处理并没有特别友好，而且问题也有不少，那么作为一个java后端，如果要提供图片的编辑服务可以怎么办？也得想办法去支持业务需求，本片博文基于此进行展开</p>
<h2 id="I-调研"><a href="#I-调研" class="headerlink" title="I. 调研"></a>I. 调研</h2><p>首先最容易想到的就是目前是不是已经有了相关的开源库，直接用不就很high了嘛，git上搜一下</p>
<h3 id="1-thumbnailator"><a href="#1-thumbnailator" class="headerlink" title="1. thumbnailator"></a>1. thumbnailator</h3><p>差不多四年都没有更新了，基于awt进行图片的编辑处理，目前提供了基本的图片编辑接口，开始用了一段时间，有几个绕不够去的坑，所以最后放弃了</p>
<p>使用姿势：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.coobird<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thumbnailator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.4.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>一个使用case:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">BufferedImage originalImage = ImageIO.read(<span class="keyword">new</span> File(<span class="string">"original.jpg"</span>));</span><br><span class="line"></span><br><span class="line">BufferedImage thumbnail = Thumbnails.of(originalImage)</span><br><span class="line">        .size(<span class="number">200</span>, <span class="number">200</span>)</span><br><span class="line">        .rotate(<span class="number">90</span>)</span><br><span class="line">        .asBufferedImage();</span><br></pre></td></tr></table></figure>
<p>问题说明：</p>
<ul>
<li>jpg图片编辑后，输出图片变红的问题（详情参考：<a href="https://liuyueyi.github.io/hexblog/2018/01/22/%E5%85%BC%E5%AE%B9ImageIO%E8%AF%BB%E5%8F%96jpeg%E5%9B%BE%E7%89%87%E5%8F%98%E7%BA%A2/" target="_blank" rel="noopener">兼容ImageIO读取jpeg图片变红</a>）</li>
<li>图片精度丢失（对于精度要求较高的场景下，直接使用Jdk的BufferedImage会丢失精度）</li>
</ul>
<p>上面两个问题中，第二个精度丢失在某些对图片质量有要求的场景下比较严重，如果业务场景没那么将就的话，用这个库还是可以减少很多事情的，下面基于ImageMagic的接口设计，很大程度上参考了该工程的使用规范，因为使用起来（+阅读）确实特别顺畅</p>
<h3 id="2-simpleimage"><a href="#2-simpleimage" class="headerlink" title="2. simpleimage"></a>2. simpleimage</h3><p>阿里的开源库，文档极其欠缺，而且良久没有人维护，没有实际使用过，感觉属于玩票的性质（个人猜测是KPI为导向下的产物）</p>
<p>如果想造轮子的话，参考它的源码，某些图片的处理方案还是不错的</p>
<h3 id="3-imagemagic-im4java"><a href="#3-imagemagic-im4java" class="headerlink" title="3. imagemagic + im4java"></a>3. imagemagic + im4java</h3><p>ImageMagic/GraphicMagic 是c++的图象处理软件，很多服务基于此来搭建图片处理服务的</p>
<ul>
<li>优点：稳定、性能高、支持接口多、开箱即用、靠谱</li>
<li>缺点：得提前配置环境，基本上改造不动，内部有问题也没辙</li>
</ul>
<p>这个方法也是下面的主要讲述重点，放弃Thumbnailator选择imagemagic的原因如下：</p>
<ul>
<li>支持更多的服务功能（比Thumbnailator多很多的接口）</li>
<li>没有精度丢失问题</li>
<li>没有图片失真问题（颜色变化，alpha值变化问题）</li>
</ul>
<h2 id="II-环境准备"><a href="#II-环境准备" class="headerlink" title="II. 环境准备"></a>II. 环境准备</h2><p>首先得安装ImageMagic环境，有不少的第三方依赖，下面提供linux和mac的安装过程</p>
<h3 id="1-linux安装过程"><a href="#1-linux安装过程" class="headerlink" title="1. linux安装过程"></a>1. linux安装过程</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 依赖安装</span></span><br><span class="line">yum install libjpeg-devel</span><br><span class="line">yum install libpng-devel</span><br><span class="line">yum install libwebp-devel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 也可以使用源码方式安装</span></span><br><span class="line">安装jpeg 包 `wget ftp://223.202.54.10/pub/web/php/libjpeg-6b.tar.gz`</span><br><span class="line">安装webp 包 `wget http://www.imagemagick.org/download/delegates/libwebp-0.5.1.tar.gz`</span><br><span class="line">安装png 包 `wget http://www.imagemagick.org/download/delegates/libpng-1.6.24.tar.gz`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 下载并安装ImageMagic</span></span><br><span class="line">wget http://www.imagemagick.org/download/ImageMagick.tar.gz</span><br><span class="line"></span><br><span class="line">tar -zxvf ImageMagick.tar.gz</span><br><span class="line"><span class="built_in">cd</span> ImageMagick-7.0.7-28</span><br><span class="line">./configure; sudo make; sudo make install</span><br></pre></td></tr></table></figure>
<p>安装完毕之后，进行测试</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ convert --version</span><br><span class="line"></span><br><span class="line">Version: ImageMagick 7.0.7-28 Q16 x86_64 2018-04-17 http://www.imagemagick.org</span><br><span class="line">Copyright: © 1999-2018 ImageMagick Studio LLC</span><br><span class="line">License: http://www.imagemagick.org/script/license.php</span><br><span class="line">Features: Cipher DPC HDRI OpenMP</span><br><span class="line">Delegates (built-in): fontconfig freetype jng jpeg lzma png webp x xml zlib</span><br></pre></td></tr></table></figure>
<h3 id="2-mac安装过程"><a href="#2-mac安装过程" class="headerlink" title="2. mac安装过程"></a>2. mac安装过程</h3><p>依赖安装</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo brew install jpeg</span><br><span class="line">sudo brew install libpng</span><br><span class="line">sudo brew install libwebp</span><br><span class="line">sudo brew install GraphicsMagick</span><br><span class="line">sudo brew install ImageMagick</span><br></pre></td></tr></table></figure>
<p>源码安装方式与上面一致</p>
<h3 id="3-问题及修复"><a href="#3-问题及修复" class="headerlink" title="3. 问题及修复"></a>3. 问题及修复</h3><p>如果安装完毕之后，可能会出现下面的问题</p>
<p>提示找不到png依赖:</p>
<ul>
<li>安装：一直找不到 png的依赖，查阅需要安装 <a href="http://pkgconfig.freedesktop.org/releases/pkg-config-0.28.tar.gz" target="_blank" rel="noopener">http://pkgconfig.freedesktop.org/releases/pkg-config-0.28.tar.gz</a></li>
</ul>
<p>执行 convert 提示linux shared libraries 不包含某个库</p>
<ul>
<li>临时方案：<code>export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH</code></li>
<li><p>永久方案：</p>
  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ld.so.conf</span><br><span class="line">在这个文件里加入：/usr/<span class="built_in">local</span>/lib 来指明共享库的搜索位置</span><br><span class="line">然后再执行/sbin/ldconf</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="4-常见Convert命令"><a href="#4-常见Convert命令" class="headerlink" title="4. 常见Convert命令"></a>4. 常见Convert命令</h3><p>imagemagic的场景使用命令如下</p>
<p>裁图 </p>
<ul>
<li>convert test.jpg -crop 640x960+0+0 output.jpg</li>
</ul>
<p>旋转 </p>
<ul>
<li>convert test.jpg -rotate 90 output.jpg</li>
</ul>
<p>缩放 </p>
<ul>
<li>convert test.jpg -resize 200x200 output.jpg</li>
</ul>
<p>强制宽高缩放 </p>
<ul>
<li>convert test.jpg -resize 200x200! output.jpg</li>
</ul>
<p>缩略图 </p>
<ul>
<li>convert -thumbnail 200x300 test.jpg thumb.jpg</li>
</ul>
<p>上下翻转：</p>
<ul>
<li>convert -flip foo.png bar.png</li>
</ul>
<p>左右翻转：</p>
<ul>
<li>convert -flop foo.png bar.png</li>
</ul>
<p>水印：</p>
<ul>
<li>composite -gravity northwest -dissolve 100 -geometry +0+0 water.png temp.jpg out.jpg</li>
</ul>
<p>添加边框 :</p>
<ul>
<li>convert -border 6x6 -bordercolor “#ffffff” test.jpg bord.jpg</li>
</ul>
<p>去除边框 :</p>
<ul>
<li>convert -thumbnail 200x300 test.jpg thumb.jpg</li>
</ul>
<h2 id="III-接口设计与实现"><a href="#III-接口设计与实现" class="headerlink" title="III. 接口设计与实现"></a>III. 接口设计与实现</h2><p>java调用ImageMagic的方式有两种，一个是基于命令行的，一种是基于JNI的，我们选则im4java来操作imagemagic的接口（基于命令行的操作）</p>
<p><strong>目标：</strong></p>
<p>对外的使用姿势尽可能如 <code>Thumbnailtor</code>，采用builder模式来设置参数，支持多种输入输出</p>
<h3 id="1-im4java使用姿势"><a href="#1-im4java使用姿势" class="headerlink" title="1. im4java使用姿势"></a>1. im4java使用姿势</h3><p>几个简单的case，演示下如何使用im4java实现图片的操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">IMOperation op = <span class="keyword">new</span> IMOperation();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 裁剪</span></span><br><span class="line">op.crop(operate.getWidth(), operate.getHeight(), operate.getX(), operate.getY());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 旋转</span></span><br><span class="line">op.rotate(rotate);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩</span></span><br><span class="line">op.resize(operate.getWidth(), operate.getHeight());</span><br><span class="line">op.quality(operate.getQuality().doubleValue()); <span class="comment">// 精度</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 翻转</span></span><br><span class="line">op.flip();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 镜像</span></span><br><span class="line">op.flop();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 水印</span></span><br><span class="line">op.geometry(operate.getWidth(), operate.getHeight(), operate.getX(), operate.getY()).composite();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 边框</span></span><br><span class="line">op.border(operate.getWidth(), operate.getHeight()).bordercolor(operate.getColor());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 原始命令方式添加</span></span><br><span class="line">op.addRawArgs(<span class="string">"-resize"</span>, <span class="string">"!100x200"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加原始图片地址</span></span><br><span class="line">op.addImage(sourceFilename);</span><br><span class="line"><span class="comment">// 目标图片地址</span></span><br><span class="line">op.addImage(outputFilename);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/** 传true到构造函数中,则表示使用GraphicMagic, 裁图时,图片大小会变 */</span></span><br><span class="line">ConvertCmd convert = <span class="keyword">new</span> ConvertCmd();</span><br><span class="line">convert.run(op);</span><br></pre></td></tr></table></figure>
<h3 id="2-使用姿势"><a href="#2-使用姿势" class="headerlink" title="2. 使用姿势"></a>2. 使用姿势</h3><p>在具体的设计接口之前，不妨先看一下最终的使用姿势，然后逆向的再看是如何设计的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String localFile = <span class="string">"blogInfoV2.png"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 复合操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOperate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    BufferedImage img;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        img = ImgWrapper.of(localFile)</span><br><span class="line">                .board(<span class="number">10</span>, <span class="number">10</span>, <span class="string">"red"</span>)</span><br><span class="line">                .flip()</span><br><span class="line">                .rotate(<span class="number">180</span>)</span><br><span class="line">                .crop(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1200</span>, <span class="number">500</span>)</span><br><span class="line">                .asImg();</span><br><span class="line">        System.out.println(<span class="string">"--- "</span> + img);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面这个方法，演示了图片的多个操作，首先是加个红色边框，然后翻转，然后旋转180°，再裁剪输出图片</p>
<p>所以这个封装，肯定是使用了Builder模式了，接下来看下配置参数</p>
<h3 id="3-接口设计"><a href="#3-接口设计" class="headerlink" title="3. 接口设计"></a>3. 接口设计</h3><p>首先确定目前支持的几个方法：<code>OperateType</code></p>
<p>其次就是相关的配置参数： <code>Operate&lt;T&gt;</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Operate</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 操作类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> OperateType operateType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 裁剪宽; 缩放宽</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer width;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 高</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer height;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 裁剪时,起始 x</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer x;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 裁剪时,起始y</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer y;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 旋转角度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Double rotate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 按照整体的缩放参数, 1 表示不变, 和裁剪一起使用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Double radio;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 图片精度, 1 - 100</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer quality;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 颜色 (添加边框中的颜色; 去除图片中某颜色)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 水印图片, 可以为图片名, uri, 或者inputstream</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> T water;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 水印图片的类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String waterImgType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 强制按照给定的参数进行压缩</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> forceScale;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">valid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (operateType) &#123;</span><br><span class="line">            <span class="keyword">case</span> CROP:</span><br><span class="line">                <span class="keyword">return</span> width != <span class="keyword">null</span> &amp;&amp; height != <span class="keyword">null</span> &amp;&amp; x != <span class="keyword">null</span> &amp;&amp; y != <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">case</span> SCALE:</span><br><span class="line">                <span class="keyword">return</span> width != <span class="keyword">null</span> || height != <span class="keyword">null</span> || radio != <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">case</span> ROTATE:</span><br><span class="line">                <span class="keyword">return</span> rotate != <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">case</span> WATER:</span><br><span class="line">                <span class="comment">// 暂时不支持水印操作</span></span><br><span class="line">                <span class="keyword">return</span> water != <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">case</span> BOARD:</span><br><span class="line">                <span class="keyword">if</span> (width == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    width = <span class="number">3</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (height == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    height = <span class="number">3</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (color == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    color = <span class="string">"#ffffff"</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">case</span> FLIP:</span><br><span class="line">            <span class="keyword">case</span> FLOP:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取水印图片的路径</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getWaterFilename</span><span class="params">()</span> <span class="keyword">throws</span> ImgOperateException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> FileWriteUtil.saveFile(water, waterImgType).getAbsFile();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> OperateType &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 裁剪</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    CROP,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 缩放</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    SCALE,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 旋转</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ROTATE,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 水印</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    WATER,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上下翻转</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    FLIP,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 水平翻转</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    FLOP,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加边框</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    BOARD;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-Builder实现"><a href="#4-Builder实现" class="headerlink" title="4. Builder实现"></a>4. Builder实现</h3><p>简化使用成本，因此针对图片裁剪、旋转等接口，封装了更友好的接口方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T sourceFile;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 图片类型 JPEG, PNG, GIF ...</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 默认为jpg图片</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String outputFormat = <span class="string">"jpg"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Operate&gt; operates = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Builder</span><span class="params">(T sourceFile)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sourceFile = sourceFile;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Builder&lt;String&gt; <span class="title">ofString</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Builder&lt;String&gt;(ImgWrapper.class.getClassLoader().getResource(str).getFile());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Builder&lt;URI&gt; <span class="title">ofUrl</span><span class="params">(URI url)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Builder&lt;URI&gt;(url);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Builder&lt;InputStream&gt; <span class="title">ofStream</span><span class="params">(InputStream stream)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Builder&lt;InputStream&gt;(stream);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置输出的文件格式</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> format</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Builder&lt;T&gt; <span class="title">setOutputFormat</span><span class="params">(String format)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.outputFormat = format;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updateOutputFormat</span><span class="params">(String originType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.outputFormat != <span class="keyword">null</span> || originType == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> index = originType.lastIndexOf(<span class="string">"."</span>);</span><br><span class="line">        <span class="keyword">if</span> (index &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.outputFormat = originType.substring(index + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 缩放</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> width</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> height</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Builder&lt;T&gt; <span class="title">scale</span><span class="params">(Integer width, Integer height, Integer quality)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> scale(width, height, quality, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Builder&lt;T&gt; <span class="title">scale</span><span class="params">(Integer width, Integer height, Integer quality, <span class="keyword">boolean</span> forceScale)</span> </span>&#123;</span><br><span class="line">        Operate operate = <span class="keyword">new</span> Operate();</span><br><span class="line">        operate.setOperateType(OperateType.SCALE);</span><br><span class="line">        operate.setWidth(width);</span><br><span class="line">        operate.setHeight(height);</span><br><span class="line">        operate.setQuality(quality);</span><br><span class="line">        operate.setForceScale(forceScale);</span><br><span class="line">        operates.add(operate);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 按照比例进行缩放</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> radio 1.0 表示不缩放, 0.5 缩放为一半</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Builder&lt;T&gt; <span class="title">scale</span><span class="params">(Double radio, Integer quality)</span> </span>&#123;</span><br><span class="line">        Operate operate = <span class="keyword">new</span> Operate();</span><br><span class="line">        operate.setOperateType(OperateType.SCALE);</span><br><span class="line">        operate.setRadio(radio);</span><br><span class="line">        operate.setQuality(quality);</span><br><span class="line">        operates.add(operate);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 裁剪</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> y</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> width</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> height</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Builder&lt;T&gt; <span class="title">crop</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">        Operate operate = <span class="keyword">new</span> Operate();</span><br><span class="line">        operate.setOperateType(OperateType.CROP);</span><br><span class="line">        operate.setWidth(width);</span><br><span class="line">        operate.setHeight(height);</span><br><span class="line">        operate.setX(x);</span><br><span class="line">        operate.setY(y);</span><br><span class="line">        operates.add(operate);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 旋转</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rotate</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Builder&lt;T&gt; <span class="title">rotate</span><span class="params">(<span class="keyword">double</span> rotate)</span> </span>&#123;</span><br><span class="line">        Operate operate = <span class="keyword">new</span> Operate();</span><br><span class="line">        operate.setOperateType(OperateType.ROTATE);</span><br><span class="line">        operate.setRotate(rotate);</span><br><span class="line">        operates.add(operate);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上下翻转</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Builder&lt;T&gt; <span class="title">flip</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Operate operate = <span class="keyword">new</span> Operate();</span><br><span class="line">        operate.setOperateType(OperateType.FLIP);</span><br><span class="line">        operates.add(operate);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 左右翻转,即镜像</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Builder&lt;T&gt; <span class="title">flop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Operate operate = <span class="keyword">new</span> Operate();</span><br><span class="line">        operate.setOperateType(OperateType.FLOP);</span><br><span class="line">        operates.add(operate);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加边框</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> width  边框的宽</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> height 边框的高</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> color  边框的填充色</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Builder&lt;T&gt; <span class="title">board</span><span class="params">(Integer width, Integer height, String color)</span> </span>&#123;</span><br><span class="line">        Operate args = <span class="keyword">new</span> Operate();</span><br><span class="line">        args.setOperateType(OperateType.BOARD);</span><br><span class="line">        args.setWidth(width);</span><br><span class="line">        args.setHeight(height);</span><br><span class="line">        args.setColor(color);</span><br><span class="line">        operates.add(args);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加水印</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> water 水印的源图片 (默认为png格式)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x     添加到目标图片的x坐标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> y     添加到目标图片的y坐标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;U&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;U&gt; <span class="function">Builder&lt;T&gt; <span class="title">water</span><span class="params">(U water, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> water(water, <span class="string">"png"</span>, x, y);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加水印</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> water</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> imgType 水印图片的类型; 当传入的为inputStream时, 此参数才有意义</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> y</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;U&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;U&gt; <span class="function">Builder&lt;T&gt; <span class="title">water</span><span class="params">(U water, String imgType, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        Operate&lt;U&gt; operate = <span class="keyword">new</span> Operate&lt;&gt;();</span><br><span class="line">        operate.setOperateType(OperateType.WATER);</span><br><span class="line">        operate.setX(x);</span><br><span class="line">        operate.setY(y);</span><br><span class="line">        operate.setWater(water);</span><br><span class="line">        operate.setWaterImgType(imgType);</span><br><span class="line">        operates.add(operate);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行图片处理, 并保存文件为: 源文件_out.jpg （类型由输出的图片类型决定）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 保存的文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toFile</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> toFile(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行图片处理,并将结果保存为指定文件名的file</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputFilename 若为null, 则输出文件为 源文件_out.jpg 这种格式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toFile</span><span class="params">(String outputFilename)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(operates)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ImgOperateException(<span class="string">"operates null!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 获取原始的图片信息， 并构建输出文件名</span></span><br><span class="line"><span class="comment">         *  1. 远程图片，则保存到临时目录下</span></span><br><span class="line"><span class="comment">         *  2. stream， 保存到临时目录下</span></span><br><span class="line"><span class="comment">         *  3. 本地文件</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * 输出文件都放在临时文件夹内，和原文件同名，加一个_out进行区分</span></span><br><span class="line"><span class="comment">         **/</span></span><br><span class="line">        FileWriteUtil.FileInfo sourceFile = createFile();</span><br><span class="line">        <span class="keyword">if</span> (outputFilename == <span class="keyword">null</span>) &#123;</span><br><span class="line">            outputFilename = FileWriteUtil.getTmpPath() + <span class="string">"/"</span></span><br><span class="line">                    + sourceFile.getFilename() + <span class="string">"_"</span></span><br><span class="line">                    + System.currentTimeMillis() + <span class="string">"_out."</span> + outputFormat;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 执行图片的操作 */</span></span><br><span class="line">        <span class="keyword">if</span> (ImgBaseOperate.operate(operates, sourceFile.getAbsFile(), outputFilename)) &#123;</span><br><span class="line">            <span class="keyword">return</span> outputFilename;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行图片操作,并输出字节流</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> InputStream <span class="title">asStream</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(operates)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ImgOperateException(<span class="string">"operate null!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String outputFilename = <span class="keyword">this</span>.toFile();</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(outputFilename)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(outputFilename));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] asBytes() <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(operates)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ImgOperateException(<span class="string">"operate null!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String outputFilename = <span class="keyword">this</span>.toFile();</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(outputFilename)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> BytesTool.file2bytes(outputFilename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BufferedImage <span class="title">asImg</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(operates)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ImgOperateException(<span class="string">"operate null!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String outputFilename = <span class="keyword">this</span>.toFile();</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(outputFilename)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ImageIO.read(<span class="keyword">new</span> File(outputFilename));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> FileWriteUtil.<span class="function">FileInfo <span class="title">createFile</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.sourceFile <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">            <span class="comment">/** 生成的文件在源文件目录下 */</span></span><br><span class="line">            updateOutputFormat((String) <span class="keyword">this</span>.sourceFile);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.sourceFile <span class="keyword">instanceof</span> URI) &#123;</span><br><span class="line">            <span class="comment">/** 源文件和生成的文件都保存在临时目录下 */</span></span><br><span class="line">            String urlPath = ((URI) <span class="keyword">this</span>.sourceFile).getPath();</span><br><span class="line">            updateOutputFormat(urlPath);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> FileWriteUtil.saveFile(<span class="keyword">this</span>.sourceFile, outputFormat);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参数的设置相关的比较清晰，唯一需要注意的是输出<code>asFile()</code>，这个里面实现了一些有意思的东西</p>
<ul>
<li>保存原图片（将网络/二进制的原图，保存到本地）</li>
<li>生成临时输出文件</li>
<li>命令执行</li>
</ul>
<p>上面前两个，主要是借助辅助工具 FileWriteUtil实现，与主题的关联不大，但是内部东西还是很有意思的，推荐查看：</p>
<ul>
<li><a href="https://github.com/liuyueyi/quick-media/blob/master/plugins/base-plugin/src/main/java/com/github/hui/quick/plugin/base/FileWriteUtil.java" target="_blank" rel="noopener">https://github.com/liuyueyi/quick-media/blob/master/plugins/base-plugin/src/main/java/com/github/hui/quick/plugin/base/FileWriteUtil.java</a></li>
</ul>
<p>命令执行的封装如下(就是解析Operate参数，翻译成对应的IMOperation)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 执行图片的复合操作</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> operates</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sourceFilename 原始图片名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> outputFilename 生成图片名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> ImgOperateException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">operate</span><span class="params">(List&lt;ImgWrapper.Builder.Operate&gt; operates, String sourceFilename, String outputFilename)</span> <span class="keyword">throws</span> ImgOperateException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        IMOperation op = <span class="keyword">new</span> IMOperation();</span><br><span class="line">        <span class="keyword">boolean</span> operateTag = <span class="keyword">false</span>;</span><br><span class="line">        String waterFilename = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (ImgWrapper.Builder.Operate operate : operates) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!operate.valid()) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (operate.getOperateType() == ImgWrapper.Builder.OperateType.CROP) &#123;</span><br><span class="line">                op.crop(operate.getWidth(), operate.getHeight(), operate.getX(), operate.getY());</span><br><span class="line"><span class="comment">//                    if (operate.getRadio() != null &amp;&amp; Math.abs(operate.getRadio() - 1.0) &gt; 0.005) &#123;</span></span><br><span class="line"><span class="comment">//                        // 需要对图片进行缩放</span></span><br><span class="line"><span class="comment">//                        op.resize((int) Math.ceil(operate.getWidth() * operate.getRadio()));</span></span><br><span class="line"><span class="comment">//                    &#125;</span></span><br><span class="line">                operateTag = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (operate.getOperateType() == ImgWrapper.Builder.OperateType.ROTATE) &#123;</span><br><span class="line">                <span class="comment">// fixme 180度旋转后裁图,会出现bug, 先这么兼容</span></span><br><span class="line">                <span class="keyword">double</span> rotate = operate.getRotate();</span><br><span class="line">                <span class="keyword">if</span> (Math.abs((rotate % <span class="number">360</span>) - <span class="number">180</span>) &lt;= <span class="number">0.005</span>) &#123;</span><br><span class="line">                    rotate += <span class="number">0.01</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                op.rotate(rotate);</span><br><span class="line">                operateTag = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (operate.getOperateType() == ImgWrapper.Builder.OperateType.SCALE) &#123;</span><br><span class="line">                <span class="keyword">if</span> (operate.getRadio() == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (operate.isForceScale()) &#123; <span class="comment">// 强制根据给定的参数进行压缩时</span></span><br><span class="line">                        StringBuilder builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                        builder.append(<span class="string">"!"</span>).append(operate.getWidth() == <span class="keyword">null</span> ? <span class="string">""</span> : operate.getWidth()).append(<span class="string">"x"</span>);</span><br><span class="line">                        builder.append(operate.getHeight() == <span class="keyword">null</span> ? <span class="string">""</span> : operate.getHeight());</span><br><span class="line">                        op.addRawArgs(<span class="string">"-resize"</span>, builder.toString());</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        op.resize(operate.getWidth(), operate.getHeight());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(Math.abs(operate.getRadio() - <span class="number">1</span>) &gt; <span class="number">0.005</span>) &#123;</span><br><span class="line">                    <span class="comment">// 对图片进行比例缩放</span></span><br><span class="line">                    op.addRawArgs(<span class="string">"-resize"</span>, <span class="string">"%"</span> + (operate.getRadio() * <span class="number">100</span>));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (operate.getQuality() != <span class="keyword">null</span> &amp;&amp; operate.getQuality() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    op.quality(operate.getQuality().doubleValue());</span><br><span class="line">                &#125;</span><br><span class="line">                operateTag = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (operate.getOperateType() == ImgWrapper.Builder.OperateType.FLIP) &#123;</span><br><span class="line">                op.flip();</span><br><span class="line">                operateTag = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (operate.getOperateType() == ImgWrapper.Builder.OperateType.FLOP) &#123;</span><br><span class="line">                op.flop();</span><br><span class="line">                operateTag = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (operate.getOperateType() == ImgWrapper.Builder.OperateType.WATER &amp;&amp; waterFilename == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 当前只支持添加一次水印</span></span><br><span class="line">                op.geometry(operate.getWidth(), operate.getHeight(), operate.getX(), operate.getY())</span><br><span class="line">                        .composite();</span><br><span class="line">                waterFilename = operate.getWaterFilename();</span><br><span class="line">                operateTag = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (operate.getOperateType() == ImgWrapper.Builder.OperateType.BOARD) &#123;</span><br><span class="line">                op.border(operate.getWidth(), operate.getHeight()).bordercolor(operate.getColor());</span><br><span class="line">                operateTag = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!operateTag) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ImgOperateException(<span class="string">"operate illegal! operates: "</span> + operates);</span><br><span class="line">        &#125;</span><br><span class="line">        op.addImage(sourceFilename);</span><br><span class="line">        <span class="keyword">if</span> (waterFilename != <span class="keyword">null</span>) &#123;</span><br><span class="line">            op.addImage(waterFilename);</span><br><span class="line">        &#125;</span><br><span class="line">        op.addImage(outputFilename);</span><br><span class="line">        <span class="comment">/** 传true到构造函数中,则表示使用GraphicMagic, 裁图时,图片大小会变 */</span></span><br><span class="line">        ConvertCmd convert = <span class="keyword">new</span> ConvertCmd();</span><br><span class="line">        convert.run(op);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        log.error(<span class="string">"file read error!, e: &#123;&#125;"</span>, e);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        log.error(<span class="string">"interrupt exception! e: &#123;&#125;"</span>, e);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IM4JavaException e) &#123;</span><br><span class="line">        log.error(<span class="string">"im4java exception! e: &#123;&#125;"</span>, e);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-接口封装"><a href="#5-接口封装" class="headerlink" title="5. 接口封装"></a>5. 接口封装</h3><p>包装一个对外使用的方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImgWrapper</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据本地图片进行处理</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Builder&lt;String&gt; <span class="title">of</span><span class="params">(String file)</span> </span>&#123;</span><br><span class="line">        checkForNull(file, <span class="string">"Cannot specify null for input file."</span>);</span><br><span class="line">        <span class="keyword">if</span> (file.startsWith(<span class="string">"http"</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"file should not be URI resources! file: "</span> + file);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Builder.ofString(file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Builder&lt;URI&gt; <span class="title">of</span><span class="params">(URI uri)</span> </span>&#123;</span><br><span class="line">        checkForNull(uri, <span class="string">"Cannot specify null for input uri."</span>);</span><br><span class="line">        <span class="keyword">return</span> Builder.ofUrl(uri);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Builder&lt;InputStream&gt; <span class="title">of</span><span class="params">(InputStream inputStream)</span> </span>&#123;</span><br><span class="line">        checkForNull(inputStream, <span class="string">"Cannot specify null for InputStream."</span>);</span><br><span class="line">        <span class="keyword">return</span> Builder.ofStream(inputStream);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">checkForNull</span><span class="params">(Object o, String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="IV-测试"><a href="#IV-测试" class="headerlink" title="IV. 测试"></a>IV. 测试</h2><p>上面基本上完成了整个接口的设计与实现，接下来就是接口测试了</p>
<p>给出几个使用姿势演示，更多可以查看：<a href="https://github.com/liuyueyi/quick-media/blob/master/plugins/imagic-plugin/src/test/java/com/github/hui/quick/plugin/test/ImgWrapperTest.java" target="_blank" rel="noopener">ImgWrapperTest</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String url = <span class="string">"http://a.hiphotos.baidu.com/image/pic/item/14ce36d3d539b6006a6cc5d0e550352ac65cb733.jpg"</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String localFile = <span class="string">"blogInfoV2.png"</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCutImg</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 保存到本地</span></span><br><span class="line">        ImgWrapper.of(URI.create(url))</span><br><span class="line">                .crop(<span class="number">10</span>, <span class="number">20</span>, <span class="number">500</span>, <span class="number">500</span>)</span><br><span class="line">                .toFile();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testRotateImg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        InputStream stream = FileReadUtil.getStreamByFileName(localFile);</span><br><span class="line">        BufferedImage img = ImgWrapper.of(stream).rotate(<span class="number">90</span>).asImg();</span><br><span class="line">        System.out.println(<span class="string">"----"</span> + img);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testWater</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    BufferedImage img;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        img = ImgWrapper.of(URI.create(url))</span><br><span class="line">                .board(<span class="number">10</span>, <span class="number">10</span>, <span class="string">"red"</span>)</span><br><span class="line">                .water(localFile, <span class="number">100</span>, <span class="number">100</span>)</span><br><span class="line">                .asImg();</span><br><span class="line">        System.out.println(<span class="string">"--- "</span> + img);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="V-其他"><a href="#V-其他" class="headerlink" title="V. 其他"></a>V. 其他</h2><h3 id="项目："><a href="#项目：" class="headerlink" title="项目："></a>项目：</h3><p><strong>GitHub:</strong></p>
<ul>
<li>项目：<a href="https://github.com/liuyueyi/quick-media" target="_blank" rel="noopener">Quick-Media</a></li>
<li>源码：<a href="https://github.com/liuyueyi/quick-media/tree/master/plugins/imagic-plugin" target="_blank" rel="noopener">imagic-plugin</a></li>
</ul>
<p><strong>Gitee:</strong></p>
<ul>
<li>项目：<a href="https://gitee.com/liuyueyi/quick-media" target="_blank" rel="noopener">Quick-Media</a></li>
<li>源码：<a href="https://gitee.com/liuyueyi/quick-media/tree/master/plugins/imagic-plugin" target="_blank" rel="noopener">imagic-plugin</a></li>
</ul>
<h3 id="个人博客：-一灰灰Blog"><a href="#个人博客：-一灰灰Blog" class="headerlink" title="个人博客： 一灰灰Blog"></a>个人博客： <a href="https://liuyueyi.github.io/hexblog" target="_blank" rel="noopener">一灰灰Blog</a></h3><p>基于hexo + github pages搭建的个人博客，记录所有学习和工作中的博文，欢迎大家前去逛逛</p>
<h3 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h3><p>尽信书则不如，已上内容，纯属一家之言，因本人能力一般，见识有限，如发现bug或者有更好的建议，随时欢迎批评指正</p>
<ul>
<li>微博地址: <a href="https://weibo.com/p/1005052169825577/home" target="_blank" rel="noopener">小灰灰Blog</a></li>
<li>QQ： 一灰灰/3302797840</li>
</ul>
<h3 id="扫描关注"><a href="#扫描关注" class="headerlink" title="扫描关注"></a>扫描关注</h3><p><img src="https://raw.githubusercontent.com/liuyueyi/Source/master/img/info/blogInfoV2.png" alt="QrCode"></p>
</div><div class="tags"><a href="/hexblog/tags/ImageMagic/">ImageMagic</a></div><div style="text-align:center"><br><button style="color:red;background-color: #f44336;border: none;border-radius: 8px;color: white;padding: 10px 30px;text-align: center;text-decoration: none;font-size: 16px;" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">打赏</button><br><span style="display: block;color: #9d9d9d;font: 14px/2 &amp;quot;Microsoft Yahei&amp;quot;">如果觉得我的文章对您有帮助，请随意打赏。</span><br><div id="QR" style="display: none; margin-top: 20px;" class="row"><div id="wechat" style="display: inline-block;width:44%;margin-left:6%;text-align:center;"><a href="javascript:void(0)"><img src="https://s3.mogucdn.com/mlcdn/c45406/180104_50136i33id9e49j1f7k2e219e3ldf_800x798.png" alt="WeChat Pay" style="width:80%;height:80%;max-height:200px;max-width:200px"></a><p style="text-align:center">微信打赏</p></div><div id="alipay" style="display: inline-block;width:44%;text-align:center"><a href="javascript:void(0)"><img src="https://s3.mogucdn.com/mlcdn/c45406/180104_0e6afl33b23lacj6ji2d7d060aiak_798x800.png" alt="Alipay" style="width:80%;height:80%;max-height:200px;max-width:200px"></a><p style="text-align:center">支付宝打赏</p></div></div></div><div class="article-footer-copyright"><url><li>版权声明：本文由<b> 一灰灰 </b><span>发表于</span><a href="/hexblog/"> 一灰灰Blog </a></li><li>转载声明：自由转载-非商用-非衍生-保持署名，非商业转载请注明作者及出处，商业转载请联系作者本人。</li><li id="blogTitleCp">文章标题：<a style="word-wrap:break-word">Java 借助ImageMagic实现图片编辑服务</a></li><li>文章链接：<a id="blogLink" style="word-wrap:break-word"></a><script>var blogLink = decodeURI(window.location.href);
var doc = document.getElementById('blogLink');
doc.setAttribute("href", blogLink);
doc.innerHTML=blogLink;</script></li></url></div><div class="post-share"><div><script src="https://s3.mogucdn.com/mlcdn/c45406/1520387600580_dom-to-image.min.js" charset="utf-8"></script><script>var url;
console.log('start--->',(new Date()).valueOf());
domtoimage.toPng(document.getElementsByClassName('layout-l')[0])
    .then(function (dataUrl) {
        url = dataUrl;
        console.log('end--->',(new Date()).valueOf());
     })
    .catch(function (error) {});
function link() {
    var title = document.getElementById('blogTitleCp').children[0].innerText;
    console.log("blog title: ", title);
    window.open().document.write('<html><head><title>'+ title + '</title></head><body><div style=\'text-align:center\' ><a download="一灰灰Blog博文_' + title + '.png" href="'+url+'"><img title="点击下载博文图：' + title + '" src="' + url + '" /></a></div></body></html>');
}</script><span style="float:center;font-size:20px;font-weight:solid;color:gray">渲染：</span><a id="saveImg" href="javascript:void(0)" onclick="link()" class="save_img">保存图片</a></div><div id="share" class="soshm social-share"><span style="float:center;font-size:20px;font-weight:solid;color:gray">分享：</span></div></div><div class="post-nav"><a href="/hexblog/2018/04/18/18年4月18日离杭小记/" class="pre">18年4月18日离杭小记</a><a href="/hexblog/2018/04/16/CSS图片点击拷贝/" class="next">CSS图片点击拷贝</a></div><div id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zNDY0OC8xMTE4NQ=="></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei"> 文章目录</i><a title="点击展开或隐藏分类" href="javascript:void(0)" onclick="showOrHide('toc', 'toc-expand', 'none')"><span id="toc-expand" style="font-size:12px;color:red"> 点击收起 </span></a></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Java-借助ImageMagic实现图片编辑服务"><span class="toc-text">Java 借助ImageMagic实现图片编辑服务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#I-调研"><span class="toc-text">I. 调研</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-thumbnailator"><span class="toc-text">1. thumbnailator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-simpleimage"><span class="toc-text">2. simpleimage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-imagemagic-im4java"><span class="toc-text">3. imagemagic + im4java</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#II-环境准备"><span class="toc-text">II. 环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-linux安装过程"><span class="toc-text">1. linux安装过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-mac安装过程"><span class="toc-text">2. mac安装过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-问题及修复"><span class="toc-text">3. 问题及修复</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-常见Convert命令"><span class="toc-text">4. 常见Convert命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#III-接口设计与实现"><span class="toc-text">III. 接口设计与实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-im4java使用姿势"><span class="toc-text">1. im4java使用姿势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-使用姿势"><span class="toc-text">2. 使用姿势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-接口设计"><span class="toc-text">3. 接口设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Builder实现"><span class="toc-text">4. Builder实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-接口封装"><span class="toc-text">5. 接口封装</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IV-测试"><span class="toc-text">IV. 测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#V-其他"><span class="toc-text">V. 其他</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#项目："><span class="toc-text">项目：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#个人博客：-一灰灰Blog"><span class="toc-text">个人博客： 一灰灰Blog</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#声明"><span class="toc-text">声明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#扫描关注"><span class="toc-text">扫描关注</span></a></li></ol></li></ol></li></ol></div><div class="widget"><div class="widget-title"><a href="/hexblog/about/"><i class="fa fa-user"> 一灰灰Blog</i></a><a title="点击展开或收起条目" href="javascript:void(0)" onclick="showOrHide('info-list', 'info-list-expand', 'none')"><span id="info-list-expand" style="font-size:12px;color:red"> 点击收起 </span></a></div><ul class="post-list info-list"><li style="text-align:center"><img src="//s3.mogucdn.com/mlcdn/c45406/170419_637cgff527i8k9k8h512iaf36cdia_600x600.jpg" style="max-width:80px;radius:80px"/><p style="text-align:center">好好学习，天天搬砖</p><hr style="height:0.1px;border:none;border-top:1px dashed #0066CC;"/></li><li class="post-list-item"><a href="mailto:bangzewu@126.com" title="126邮箱" class="post-list-link"><i class="fa fa-email">  bangzewu@126.com</i></a></li><li class="post-list-item"><a href="//github.com/liuyueyi" title="Git主页" target="_blank" class="post-list-link"><i class="fa fa-github">  github.com/liuyueyi</i></a></li><li class="post-list-item"><a href="" title="QQ" class="post-list-link"><i class="fa fa-you">  QQ:3302797840</i></a></li><li class="post-list-item"><a href="//weibo.com/p/1005052169825577/home" title="微博主页" target="_blank" class="post-list-link"><i class="fa fa-weibo">  微博:小灰灰Blog</i></a></li><li class="post-list-item"><i class="fa fa-weixin">  微信公众号</i></li><li style="text-align:center" class="post-list-item"><img src="https://s10.mogucdn.com/mlcdn/c45406/171229_1cgld3igbelkbc70cd8af1j3809kb_150x150.jpg"/></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章(10)</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/hexblog/2018/04/24/redis环境搭建/">redis安装</a></li><li class="post-list-item"><a class="post-list-link" href="/hexblog/2018/04/18/18年4月18日离杭小记/">18年4月18日离杭小记</a></li><li class="post-list-item"><a class="post-list-link" href="/hexblog/2018/04/17/Java-借助ImageMagic实现图片编辑服务/">Java 借助ImageMagic实现图片编辑服务</a></li><li class="post-list-item"><a class="post-list-link" href="/hexblog/2018/04/16/CSS图片点击拷贝/">CSS图片点击拷贝</a></li><li class="post-list-item"><a class="post-list-link" href="/hexblog/2018/04/13/生产环境分库分表的实际操作全记录/">生产环境分库分表的实际操作全记录</a></li><li class="post-list-item"><a class="post-list-link" href="/hexblog/2018/04/11/Mybatis框架学习之使用篇二：标签语法/">Mybatis框架学习之使用篇二：标签语法</a></li><li class="post-list-item"><a class="post-list-link" href="/hexblog/2018/04/11/Mybatis框架学习之使用篇一：基本环境/">Mybatis框架学习之使用篇一：基本环境</a></li><li class="post-list-item"><a class="post-list-link" href="/hexblog/2018/04/10/Java实现邮件发送/">Java实现邮件发送</a></li><li class="post-list-item"><a class="post-list-link" href="/hexblog/2018/04/09/基于ForkJoin构建一个简单易用的并发组件/">基于ForkJoin构建一个简单易用的并发组件</a></li><li class="post-list-item"><a class="post-list-link" href="/hexblog/2018/04/01/Css实战训练之图片点击放大/">Css实战训练之图片点击放大</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类(63)</i><a title="点击展开或隐藏分类" href="javascript:void(0)" onclick="showOrHide('category-list-child', 'category-expand', 'block')"><span id="category-expand" style="font-size:12px;color:red"> 点击展开 </span></a></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/工作/">工作</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/工作/分库分表/">分库分表</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/工作/技术尝鲜/">技术尝鲜</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/">技术</a><span class="category-list-count">52</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Android/">Android</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Android/一封/">一封</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/BugFix/">BugFix</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/BugFix/Java/">Java</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/BugFix/Java/Image/">Image</a><span class="category-list-count">2</span></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/DB/">DB</a><span class="category-list-count">5</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/DB/Mybatis/">Mybatis</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/DB/Mysql/">Mysql</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Java/">Java</a><span class="category-list-count">19</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Java/IO/">IO</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Java/JDK/">JDK</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Java/JVM/">JVM</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Java/JavaWeb/">JavaWeb</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Java/Spring/">Spring</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Java/并发/">并发</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Quick系列项目/">Quick系列项目</a><span class="category-list-count">12</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Quick系列项目/QuickAlarm/">QuickAlarm</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Quick系列项目/QuickMedia/">QuickMedia</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Quick系列项目/QuickSpi/">QuickSpi</a><span class="category-list-count">4</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Redis/">Redis</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Shell/">Shell</a><span class="category-list-count">7</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Shell/Git/">Git</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Shell/Git/Maven/">Maven</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Shell/Nginx/">Nginx</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/Shell/环境搭建/">环境搭建</a><span class="category-list-count">5</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/前端/">前端</a><span class="category-list-count">5</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/前端/Chrome/">Chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/前端/Css/">Css</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/技术/前端/Jquery/">Jquery</a><span class="category-list-count">1</span></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/杂记/">杂记</a><span class="category-list-count">5</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/杂记/idea/">idea</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/杂记/吐槽/">吐槽</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/杂记/小工具/">小工具</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/生活/">生活</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/hexblog/categories/生活/随笔/">随笔</a><span class="category-list-count">2</span></li></ul></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签墙(63)</i><a title="点击展开或隐藏分类" href="javascript:void(0)" onclick="showOrHide('tagcloud', 'tag-expand', 'none')"><span id="tag-expand" style="font-size:12px;color:red"> 点击收起 </span></a></div><div class="tagcloud"><!--!= tagcloud({min_font: 15, max_font: 15, amount: 100, orderby: 'count'})--><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Initialize/">Initialize</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/JVM/">JVM</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/小记/">小记</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/日记/">日记</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Android/">Android</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/一封/">一封</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/RelativeLayout/">RelativeLayout</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/CountDownTimer/">CountDownTimer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Bugfix/">Bugfix</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Java/">Java</a><span class="tag-list-count">34</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/batik/">batik</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Png/">Png</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/拷贝/">拷贝</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Gitbook/">Gitbook</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Centos/">Centos</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/教程/">教程</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Hexo/">Hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Chrome/">Chrome</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/工具/">工具</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/css/">css</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/笔记/">笔记</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/并发/">并发</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/ForkJoin/">ForkJoin</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Reflect/">Reflect</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Jquery/">Jquery</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/ClassLoader/">ClassLoader</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/双亲委托/">双亲委托</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/内存结构/">内存结构</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/垃圾回收/">垃圾回收</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/ImageMagic/">ImageMagic</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/JavaWeb/">JavaWeb</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Filter/">Filter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Servlet/">Servlet</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/JDK/">JDK</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/File/">File</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/ScheduledExecutorService/">ScheduledExecutorService</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/IO/">IO</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/clone/">clone</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/beancopy/">beancopy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Email/">Email</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/ThreadPoolExecutor/">ThreadPoolExecutor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/mybatis/">mybatis</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Nginx/">Nginx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/配置/">配置</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Redis/">Redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/distributeLock/">distributeLock</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/SPI/">SPI</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/整体设计/">整体设计</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/使用手册/">使用手册</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Spring/">Spring</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/RequestParam/">RequestParam</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Jsonp/">Jsonp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/CORS/">CORS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Exception/">Exception</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Response/">Response</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/ffmpeg/">ffmpeg</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/imagemagic/">imagemagic</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/mysql/">mysql</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/索引/">索引</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/锁/">锁</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/事务/">事务</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Github/">Github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Maven/">Maven</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/BugFix/">BugFix</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/BufferedImage/">BufferedImage</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Jpeg/">Jpeg</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/杂记/">杂记</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/Okhttp/">Okhttp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/QuickAlarm/">QuickAlarm</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/hystrix/">hystrix</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/分库分表/">分库分表</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/随笔/">随笔</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/hexblog/tags/redis/">redis</a><span class="tag-list-count">1</span></li></ul></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档(63)</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/hexblog/archives/2018/04/">四月 2018</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexblog/archives/2018/03/">三月 2018</a><span class="archive-list-count">16</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexblog/archives/2018/02/">二月 2018</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexblog/archives/2018/01/">一月 2018</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexblog/archives/2017/12/">十二月 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexblog/archives/2017/09/">九月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexblog/archives/2017/08/">八月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexblog/archives/2017/05/">五月 2017</a><span class="archive-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 更多链接</i></div><ul style="padding-top:10px"></ul><li style="padding-top:2px"><a href="//my.oschina.net/u/566591" title="开源中国" target="_blank">开源中国</a></li><li style="padding-top:2px"><a href="//blog.csdn.net/liuyueyi25" title="CSDN" target="_blank">CSDN</a></li><li style="padding-top:2px"><a href="//www.jianshu.com/u/5902ab08e670" title="简书" target="_blank">简书</a></li><li style="padding-top:2px"><a href="//juejin.im/user/5a2a4b095188252ae93adbbf/posts" title="掘金" target="_blank">掘金</a></li><li style="padding-top:2px"><a href="//www.toutiao.com/c/user/69862071663/#mid=1579653107239950" title="头条" target="_blank">头条</a></li><li style="padding-top:2px"><a href="//cloud.tencent.com/developer/column/1847" title="云+" target="_blank">云+</a></li><li style="padding-top:2px"><a href="//github.com/liuyueyi" title="Github" target="_blank">Github</a></li><li style="padding-top:2px"><a href="//gitee.com/liuyueyi" title="Gitee" target="_blank">Gitee</a></li></div><div class="widget"><div class="widget-title"><i onclick="var qr = document.getElementById('qrcode'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}" style="cursor:pointer" class="fa fa-hit"> 点赞(点击展开)</i></div><ul id="qrcode" style="display:none;" class="post-list"><br/><li style="text-align:center" class="post-list-item"><a href="javascript:void(0)" target="_blank"><img src="https://s3.mogucdn.com/mlcdn/c45406/180104_50136i33id9e49j1f7k2e219e3ldf_800x798.png" alt="WeChat Pay" style="width:75%"/><br/><p style="text-align:center">微信打赏</p></a></li><li style="text-align:center" class="post-list-item"><a href="javascript:void(0)" target="_blank"><img src="https://s3.mogucdn.com/mlcdn/c45406/180104_0e6afl33b23lacj6ji2d7d060aiak_798x800.png" alt="Alipay" style="width:75%"/><br/><p style="text-align:center">支付宝打赏</p></a></li></ul></div></div></div></div><a id="totop" href="#top"></a><div id="render"><script src="https://s3.mogucdn.com/mlcdn/c45406/1520387600580_dom-to-image.min.js" charset="utf-8"></script><div class="rInput"><input id="choose-id" type="text" placeholder="cid: | id: + 标签" onkeydown="if(event.keyCode==13) {doRender();}"></div><div class="rSendBtn"><a id="rImgBtn" onclick="doRender()">渲染</a></div></div><script type="text/javascript" src="/hexblog/js/render.js?v=2.0.1" async></script><div id="footer"><div class="footer-info"><p><a href="https://zbang.online/webs"><img src="//s3.mogucdn.com/mlcdn/c45406/170419_637cgff527i8k9k8h512iaf36cdia_600x600.jpg" style="max-width: 44px;border-radius:44px"></a></p><p><a href="https://github.com/liuyueyi" target="_blank">GitHub</a> |  <a href="mailto:bangzewu@126.com">email</a> |  <a href="/hexblog/about/">关于 |</a><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p></p><p><span> Copyright &copy;<a href="/hexblog/." rel="nofollow">YiHui.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?028d9e53f991d9739ecc7cc42e13c500";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/hexblog/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/hexblog/js/toctotop.js?v=2.0.1" async></script><script src="https://s3.mogucdn.com/mlcdn/c45406/1520407228303_social-share.min.js" charset="utf-8"></script><link rel="stylesheet" href="https://s3.mogucdn.com/mlcdn/c45406/1518422561591_share.min.css"><script>(function(d, s) {
  var j, e = d.getElementsByTagName('body')[0];
  if (typeof LivereTower === 'function') { return; }
  j = d.createElement(s);
  j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
  j.async = true;
  e.appendChild(j);
})(document, 'script');
</script></body><script type="text/javascript" src="/hexblog/js/common.js?v=2.0.1" async></script></html>